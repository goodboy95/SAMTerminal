# 项目目录结构说明（截至2025-12-21）

- `frontend/`：React 18 + TypeScript + Vite 前端源代码。
  - `src/`：前端业务代码与组件（页面、UI 组件、hooks、lib 工具等）。
    - `src/lib/imageCache.ts`：图片预加载缓存工具。
    - `src/lib/__tests__/imageCache.test.ts`：图片缓存的单元测试。
  - `public/`：静态资源。
  - `nginx.conf`：前端容器的 SPA 路由回退配置。
  - `Dockerfile`：前端构建并由 Nginx 提供静态文件的镜像定义。
  - `frontend/doc/v1/`：前端设计与页面说明文档。
- `backend/`：Spring Boot 3 后端服务源码。
  - `src/main/java/com/samterminal/backend/`：主业务代码、控制器、服务、实体、配置、DTO。
    - `config/AppProperties.java`：管理员账号与 LLM 相关配置载入。
    - `config/LlmClientConfig.java`：LLM 请求 RestTemplate 超时配置。
    - `controller/ApiExceptionHandler.java`：统一参数校验错误返回。
    - `controller/WorldController.java`：世界地图与资源查询入口，初始化默认解锁地点。
    - `dto/LlmApiConfigRequest.java`：LLM API 池新增/更新请求体。
    - `dto/LlmApiConfigResponse.java`：LLM API 池列表响应体（含脱敏 apiKey）。
    - `dto/SessionResponse.java`：会话创建响应体。
    - `entity/LlmApiConfig.java`：LLM API 池配置实体。
    - `entity/LlmApiRole.java`：LLM API 主/备角色枚举。
    - `entity/LlmApiStatus.java`：LLM API 状态枚举。
    - `entity/ChatSession.java`：会话绑定实体。
    - `entity/ChatSessionStatus.java`：会话状态枚举。
    - `repository/LlmApiConfigRepository.java`：LLM API 池配置仓库。
    - `repository/ChatSessionRepository.java`：会话仓库。
    - `service/GameService.java`：游戏状态与聊天流程、地点解锁与会话绑定主流程。
    - `service/UserLocationUnlockService.java`：地点解锁的幂等写入与重复插入保护。
    - `service/LlmPoolService.java`：API 选择、熔断、负载与健康检查。
    - `service/SessionService.java`：会话创建/续期与过期处理。
    - `service/ApiLoadTracker.java`：30 秒负载统计。
    - `service/LlmApiConfigService.java`：LLM API 池管理与校验。
    - `service/AdminAccountService.java`：基于配置的管理员账号同步。
    - `service/LlmSettingMigrationService.java`：旧 LlmSetting 迁移至 API 池。
    - `service/NoAvailableApiException.java`：API 池无可用配置异常。
  - `src/main/resources/application.yml`：后端运行配置。
  - `src/test/java/...`：后端单元测试（GameServiceTest、GameServiceUnlockTest、UserLocationUnlockServiceTest、TokenUsageServiceTest、LlmPoolServiceTest、SessionServiceTest）。
  - `src/test/resources/application.yml`：测试环境配置（H2 内存库、JWT 测试密钥）。
  - `pom.xml`：Maven 依赖与插件。
  - `Dockerfile`：后端服务镜像定义。
- `doc/`：项目文档
  - `structure.md`：本文件，记录目录与作用。
  - `api/`：接口文档（见各 Controller 对应文件，如 admin/world/game/player/upload）。
  - `modules/`：模块设计与说明（含 LLM API 池模块说明）。
  - `v1.0plus-plan.md`：基于设计稿与现有代码的功能缺口与开发方案清单。
  - `v0.2.0/`：V0.2.0 版本详细开发、测试与安全性能文档。
    - `development.md`：V0.2.0 开发方案与技术设计。
    - `test-cases.md`：V0.2.0 功能测试点清单。
    - `security-performance.md`：V0.2.0 安全与性能注意事项。
  - `test/operation.md`：功能操作与测试步骤。
  - `test/integratedTest.md`：集成/系统测试用例清单。
  - `issues.md`：问题记录（若有）。
- `sql/schema.sql`：MySQL 初始化表结构定义。
- `docker-compose.yml`：编排前端、后端、MySQL、ChromaDB 服务的运行。
- `build.sh`：一键构建、测试、镜像打包并启动 docker-compose 的脚本。
- `AGENTS.md`：开发/测试强制要求。
